# xpgfuzz 变异算子增强说明

本文档说明了对 xpgfuzz 变异算子的增强改进。

## 增强概览

### 1. INTEGER 约束变异增强
- **从 15 种增加到 25 种变异策略**
- 新增策略包括：
  - 特殊数值：2, 10, 100, 1000
  - 算术运算：自加、平方、平方根
  - 位运算：左移、右移、按位取反
- 改进了边界值处理，防止溢出

### 2. STRING 约束变异增强
- **从 10 种增加到 20 种变异策略**
- **新增格式感知变异**：
  - Email 格式检测和针对性变异
  - URL 格式检测和针对性变异
  - Base64 格式检测和针对性变异
- **新增安全测试模式**：
  - 格式字符串攻击模式
  - SQL 注入模式
  - XSS 攻击模式
  - 路径遍历模式
  - Unicode 规范化攻击
- 增强的特殊字符注入策略

### 3. ENUM 约束变异增强
- **从 5 种增加到 8 种变异策略**
- 新增策略：
  - 中间值选择
  - 字符删除变异
  - 两个枚举值组合
- 改进了大小写变化和拼写错误变异

### 4. IP 约束变异增强
- **从 10 种增加到 15 种变异策略**
- **新增 MAB（Multi-Armed Bandit）支持**
- 新增策略：
  - 无效端口分隔符
  - IPv6 压缩格式
  - IPv6 完整格式
  - 无效 IPv4 段
  - 带空格的 IP（无效格式）

### 5. PATH 约束变异增强
- **从 10 种增加到 15 种变异策略**
- **新增 MAB 支持**
- 新增策略：
  - UTF-8 编码的路径遍历
  - Windows UNC 路径
  - 超长路径（超过限制）
  - 混合分隔符
  - Unicode 特殊字符路径

### 6. HEX 约束变异增强
- **从 8 种增加到 12 种变异策略**
- **新增 MAB 支持**
- 新增策略：
  - 特殊十六进制模式（0xDEADBEEF 等）
  - 带空格的十六进制
  - 无效十六进制字符
  - 大写 0X 前缀

## 技术改进

### Multi-Armed Bandit (MAB) 算法扩展
- 为所有约束类型添加了 MAB 支持
- 使用 UCB1 算法智能选择最有效的变异算子
- 根据覆盖率反馈动态调整算子权重

### 格式检测辅助函数
新增了以下格式检测函数：
- `is_email_format()`: 检测邮箱格式
- `is_url_format()`: 检测 URL 格式
- `is_base64_format()`: 检测 Base64 格式

这些函数使 STRING 约束能够进行格式感知的针对性变异。

## 变异策略统计

| 约束类型 | 原策略数 | 新策略数 | 增加 |
|---------|---------|---------|------|
| INTEGER | 15 | 25 | +10 |
| STRING  | 10 | 20 | +10 |
| ENUM    | 5  | 8  | +5  |
| IP      | 10 | 15 | +5  |
| PATH    | 10 | 15 | +5  |
| HEX     | 8  | 12 | +4  |
| **总计** | **58** | **95** | **+39** |

## 使用说明

这些增强会自动生效，无需额外配置。xpgfuzz 会根据识别出的约束类型自动选择最合适的变异策略。

### 性能影响
- MAB 算法会学习哪些变异算子最有效
- 随着运行时间增长，变异效率会逐步提升
- 格式检测函数使用轻量级启发式方法，性能开销很小

## 未来改进方向

1. **新增约束类型**：
   - CONSTRAINT_DATE / CONSTRAINT_TIMESTAMP
   - CONSTRAINT_EMAIL
   - CONSTRAINT_URL
   - CONSTRAINT_UUID
   - CONSTRAINT_MAC_ADDRESS

2. **组合变异策略**：
   - 多字段关联变异
   - 上下文感知变异
   - 反馈驱动变异

3. **历史值学习**：
   - 维护历史有效值集合
   - 基于历史值进行智能变异

## 测试建议

建议对以下场景进行测试：
1. 各种协议的不同约束类型
2. 边界值测试
3. 格式检测准确性
4. MAB 算法的收敛性
5. 性能基准测试

